<div>
  <h3 class="text-base font-semibold text-gray-900">Ultimi 30 giorni</h3>
  <dl class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
    <% @consumptions.each do |type, records| %>
    <div class="relative overflow-hidden rounded-lg bg-white px-4 pt-5 pb-12 shadow-sm sm:px-6 sm:pt-6">
      <dt>
        <div class="absolute rounded-md bg-primary/50 p-3">
          <% case type %>
          <% when "electricity" %>
            <%= render "shared/electricity" %>
          <% when "water" %>
            <%= render "shared/water" %>
          <% when "gas" %>
            <%= render "shared/gas" %>
          <% end %>
        </div>
        <p class="ml-16 truncate text-sm font-medium text-gray-500"><%= records[:label] %></p>
      </dt>
      <dd class="ml-16 flex items-baseline pb-6 sm:pb-7">
        <p class="text-2xl font-semibold text-gray-900"><%= records[:total] %></p>
        <div class="absolute inset-x-0 bottom-0 bg-gray-50 px-4 py-4 sm:px-6">
          <div class="text-sm">
            <a href="<%= admin_consumptions_path(consumption_type: type) %>" class="font-medium text-primary/60 hover:text-primary/50">Vedi tutto<span class="sr-only"> statistiche Totale Iscritti</span></a>
          </div>
        </div>
      </dd>
    </div>
    <% end %>
  </dl>
</div>

<% if @user_summary.present? %>
<div class="mt-8">
  <h3 class="text-base font-semibold text-gray-900">Riepilogo Consumi</h3>
  <div class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
    <% @user_summary.each do |type, data| %>
    <div class="relative overflow-hidden rounded-lg bg-white p-6 shadow-sm">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-4">
            <div class="rounded-md bg-primary/50 p-2">
              <% case type %>
              <% when "electricity" %>
                <%= render "shared/electricity" %>
              <% when "water" %>
                <%= render "shared/water" %>
              <% when "gas" %>
                <%= render "shared/gas" %>
              <% end %>
            </div>
            <h4 class="text-sm font-medium text-gray-900"><%= Consumption.consumption_type_label(type) %></h4>
          </div>
          
          <dl class="space-y-3">
            <div class="flex justify-between items-center">
              <dt class="text-sm text-gray-500">Totale</dt>
              <dd class="text-lg font-semibold text-gray-900"><%= data[:total] %> <%= data[:measure] %></dd>
            </div>
            
            <div class="flex justify-between items-center">
              <dt class="text-sm text-gray-500">Media</dt>
              <dd class="text-sm font-medium text-gray-700"><%= data[:average] %> <%= data[:measure] %></dd>
            </div>
            
            <div class="flex justify-between items-center">
              <dt class="text-sm text-gray-500">Letture</dt>
              <dd class="text-sm font-medium text-gray-700"><%= data[:count] %></dd>
            </div>
            
            <% if data[:last_reading].present? %>
            <div class="pt-3 border-t border-gray-200">
              <div class="flex justify-between items-center">
                <dt class="text-xs text-gray-500">Ultima lettura</dt>
                <dd class="text-sm font-medium text-primary/70"><%= data[:last_reading] %> <%= data[:measure] %></dd>
              </div>
              <% if data[:last_date].present? %>
              <p class="text-xs text-gray-400 mt-1"><%= data[:last_date].strftime("%d %b %Y") %></p>
              <% end %>
            </div>
            <% end %>
          </dl>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>
<% end %>
<div class="mt-8">
  <div class="">
    <div class="sm:flex sm:items-center">
      <div class="sm:flex-auto">
        <h1 class="text-base font-semibold text-gray-900">Analisi</h1>
        <p class="mt-2 text-sm text-gray-700">I grafici di analisi dei tuoi consumi</p>
      </div>
    </div>
  </div>
  <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
    <% @stats.each do |stat| %>
    <div class="mb-8 bg-white p-6 rounded-lg shadow-md border border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900 mb-4"><%= stat[:title] %></h2>
      <%= column_chart stat[:data], colors: ["#48bb78"] %>
    </div>
    <% end %>
  </div>
</div>
